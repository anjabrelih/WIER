(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{1414:function(e,t,n){"use strict";n(15),n(27),n(29),n(25),n(30);var r,o,l=n(39),c=n(14),d=n(2),v=n(5),f=n(10),w=n(8),h=n(9),m=n(3),y=n(7),_=(n(49),n(12),n(38),n(48),n(117),n(118),n(1264),n(75),n(36),n(0)),O=n(1803),R=n(150),x=n(1753),j=n(2542),I=n(64),k=n(106),C=n(149),D=n(273),S=n(71),$=n(1243),B=n(13),U=n(11),P=Object(U.a)(r||(r=Object(B.a)(['\n  query getReviewForDetail(\n    $productId: ID!\n    $offset: Int!\n    $limit: Int!\n    $filter: GetReviewFilter\n  ) {\n    reviewsData: getProductReviews(\n      productId: $productId\n      pagination: { offset: $offset, limit: $limit }\n      filter: $filter\n      sort: [\n        { field: "usefulness", order: desc }\n        { field: "created_at", order: desc }\n      ]\n    ) {\n      items {\n        id\n        user\n        rank\n        message\n        source\n        showAuthor\n        createdAt\n        pros\n        cons\n        medias {\n          id\n        }\n        usefulness {\n          positiveCount\n          negativeCount\n        }\n      }\n    }\n  }\n']))),L=Object(U.a)(o||(o=Object(B.a)(["\n  mutation addReviewUsefulness($reviewId: ID!, $usefulness: UsefulnessInput!) {\n    addReviewUsefulness(reviewId: $reviewId, usefulness: $usefulness) {\n      positiveCount\n      negativeCount\n    }\n  }\n"]))),E=n(1365);function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var M=function(e,t,n,desc){var r,o=arguments.length,l=o<3?t:null===desc?desc=Object.getOwnPropertyDescriptor(t,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(y.a)(Reflect))&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,desc);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(l=(o<3?r(l):o>3?r(t,n,l):r(t,n))||l);return o>3&&l&&Object.defineProperty(t,n,l),l},G=function(e){Object(w.a)(r,e);var t,n=N(r);function r(){var e;return Object(v.a)(this,r),(e=n.apply(this,arguments)).shouldBeNextButtonVisible=!1,e.loading=!1,e.nextReviewsData=[],e}return Object(f.a)(r,[{key:"mounted",value:function(){this.onNextButtonClick()}},{key:"allReviews",get:function(){return[].concat(Object(l.a)(this.reviewsData),Object(l.a)(this.nextReviewsData))}},{key:"mediaList",get:function(){var e=this;return this.allReviews.reduce((function(t,n){return[].concat(Object(l.a)(t),Object(l.a)(n.medias.map((function(t){return{alt:"".concat(e.product.title," ").concat(t.id),id:parseInt(t.id),largeImageSrc:Object(S.c)(Number(t.id),{type:S.b.DESKTOP_MEDIUM}),mediumBasicImageSrc:Object(S.c)(Number(t.id),{type:S.b.MOBILE_LARGE}),smallImageSrc:Object(S.c)(Number(t.id),{type:S.b.MOBILE_LARGE}),smallImageSrcSet:"".concat(Object(S.c)(Number(t.id),{type:S.b.MOBILE_SMALL})," 300w, ").concat(Object(S.c)(Number(t.id),{type:S.b.MOBILE_LARGE})," 550w"),title:e.product.title,type:"image"}}))))}),[])}},{key:"initialIndex",get:function(){var e=this;return this.allReviews.reduce((function(t,n){return n.id===e.activeReviewId?{tempIndex:t.tempIndex+e.activeReviewImageIndex,wasFound:!0}:t.wasFound?t:{tempIndex:t.tempIndex+n.medias.length,wasFound:!1}}),{tempIndex:0,wasFound:!1}).tempIndex}},{key:"translations",get:function(){return{cta_detailpage_next:this.$t("detail.cta_detailpage_next"),cta_detailpage_previous:this.$t("detail.cta_detailpage_previous"),load_next:this.$t("common.cta_load_next")}}},{key:"device",get:function(){return this.$resize.isDesktop?"desktop":"mobile"}},{key:"onNextButtonClick",value:(t=Object(c.a)(regeneratorRuntime.mark((function e(){var t,n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.$apollo.query({query:P,variables:{filter:{withMediaTypes:["image"]},limit:15,offset:this.allReviews.filter((function(e){return e.medias.length>0})).length,productId:this.product.id}});case 3:r=e.sent,o=null!==(t=null===(n=r.data.reviewsData)||void 0===n?void 0:n.items)&&void 0!==t?t:[],this.shouldBeNextButtonVisible=o.length>0,this.nextReviewsData=[].concat(Object(l.a)(this.nextReviewsData),Object(l.a)(o)),this.loading=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){}}]),r}(_.f);M([Object(_.d)({type:Object})],G.prototype,"product",void 0),M([Object(_.d)({required:!0,type:Array})],G.prototype,"reviewsData",void 0),M([Object(_.d)({required:!0,type:String})],G.prototype,"activeReviewId",void 0),M([Object(_.d)({required:!0,type:Number})],G.prototype,"activeReviewImageIndex",void 0),M([Object(_.b)()],G.prototype,"close",null);var A=G=M([Object(_.a)({apollo:{},components:{ProductGalleryModal:E.a}})],G),T=n(6),F=Object(T.a)(A,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("product-gallery-modal",{attrs:{"media-list":e.mediaList,"initial-index":e.initialIndex,"open-modal":!0,device:e.device,title:e.product.title,translations:e.translations,loading:e.loading,"show-load-next-button":e.shouldBeNextButtonVisible},on:{"on-next-button-click":e.onNextButtonClick,close:e.close}})],1)}),[],!1,null,"b7031984",null).exports,z=n(1277);function J(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function V(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?J(Object(source),!0).forEach((function(t){Object(d.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):J(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(m.a)(e);if(t){var o=Object(m.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var Q=function(e,t,n,desc){var r,o=arguments.length,l=o<3?t:null===desc?desc=Object.getOwnPropertyDescriptor(t,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(y.a)(Reflect))&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,desc);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(l=(o<3?r(l):o>3?r(t,n,l):r(t,n))||l);return o>3&&l&&Object.defineProperty(t,n,l),l},H=function(e){Object(w.a)(r,e);var t,n=K(r);function r(){var e;return Object(v.a)(this,r),(e=n.apply(this,arguments)).isReviewGalleryOpen=!1,e.getImageUrl=S.c,e.ImageSize=S.b,e.reviewsData=[],e.offset=0,e.storageReviewUsefulness=null,e}return Object(f.a)(r,[{key:"reviews",get:function(){var e=this;return this.reviewsData.map((function(t){var n,r,o=null!==(n=null===(r=e.storageReviewUsefulness)||void 0===r?void 0:r.reviews[t.id])&&void 0!==n?n:null;return o?V(V({},t),{},{usefulness:V(V({},t.usefulness),{},{votedNegative:-1===o,votedPositive:1===o,positiveCount:0===t.usefulness.positiveCount&&1===o?1:t.usefulness.positiveCount,negativeCount:0===t.usefulness.negativeCount&&-1===o?1:t.usefulness.negativeCount})}):t}))}},{key:"reviewStats",get:function(){var e,t,n,r;return Object(z.b)(this.product)?null===(n=this.product)||void 0===n||null===(r=n.reviewBox)||void 0===r?void 0:r.stats:null===(e=this.product)||void 0===e||null===(t=e.review)||void 0===t?void 0:t.stats}},{key:"reviewsTotalCount",get:function(){var e;return this.count||(null===(e=this.reviewStats)||void 0===e?void 0:e.messagesCount)||0}},{key:"ranksCount",get:function(){var e;return(null===(e=this.reviewStats)||void 0===e?void 0:e.ranksCount)||0}},{key:"ratings",get:function(){return Object($.b)(this.reviewStats)}},{key:"isLoadMoreReviewsBtnShown",get:function(){return this.reviews.length<this.reviewsTotalCount}},{key:"translations",get:function(){return{hide_full_review:this.$t("hide_full_review"),load_next_reviews:this.$t("detail.load_next_reviews"),rating_header:this.$t("detail.rating_header"),reviews:this.$t("detail.reviews"),source:{heureka:this.$t("detail.review_sticker_heureka"),mall:this.$t("detail.review_sticker_mall"),testujto:this.$t("detail.review_sticker_testujto")},txt_ranking_anonymous:this.$t("detail.txt_ranking_anonymous"),certified_tester:this.$t("detail.review_certified_tester")}}},{key:"userId",get:function(){var e,t;return null!==(e=null===(t=this.storageReviewUsefulness)||void 0===t?void 0:t.userId)&&void 0!==e?e:"ru_".concat(Math.random().toString(36).substr(2,9))}},{key:"created",value:function(){this.getStorageReviewUsefulness(),window.addEventListener("storage",this.onStorage)}},{key:"beforeDestroy",value:function(){window.removeEventListener("storage",this.onStorage)}},{key:"onStorage",value:function(e){"reviewUsefulness"===e.key&&this.getStorageReviewUsefulness()}},{key:"getStorageReviewUsefulness",value:function(){var e=window.localStorage.getItem("reviewUsefulness");try{e&&(this.storageReviewUsefulness=JSON.parse(e))}catch(t){window.localStorage.removeItem("reviewUsefulness"),this.$logger.error("DetailReviewsTab:getStorageReviewUsefulness",[{value:e}])}}},{key:"loadMoreReviews",value:function(){this.offset+=15}},{key:"onReviewGalleryClose",value:function(){this.isReviewGalleryOpen=!1}},{key:"onReviewImageClick",value:function(e){var t=e.reviewId,n=e.imageIndex;this.isReviewGalleryOpen=!0,this.activeReviewId=t,this.activeReviewImageIndex=n}},{key:"onClickLike",value:(t=Object(c.a)(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$apollo.mutate({mutation:L,update:function(e,o){var l=o.data.addReviewUsefulness;r.updateReviewUsefulness(e,t,r.reviewsData,l),r.updateStorage(t,n)},variables:{reviewId:t.id,usefulness:{uniqueKey:this.userId,value:n?1:-1}}});case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"updateReviewUsefulness",value:function(e,t,n,r){var o=n.findIndex((function(e){return e.id===t.id})),c={__typename:"ProductReviewCollection",items:[].concat(Object(l.a)(n.slice(0,o)),[V(V({},n[o]),{},{usefulness:V(V({},n[o].usefulness),r)})],Object(l.a)(n.slice(o+1))),hits:0};return e.writeQuery({data:{reviewsData:c},query:P,variables:{limit:15,offset:this.offset,productId:this.product.id}}),c.items}},{key:"updateStorage",value:function(e,t){if(this.storageReviewUsefulness){var n=V(V({},this.storageReviewUsefulness),{},{userId:this.userId});n.reviews[e.id]=t?1:-1,window.localStorage.setItem("reviewUsefulness",JSON.stringify(n))}else{var r={reviews:Object(d.a)({},e.id,t?1:-1),userId:this.userId};window.localStorage.setItem("reviewUsefulness",JSON.stringify(r))}window.dispatchEvent(new StorageEvent("storage",{key:"reviewUsefulness"}))}}]),r}(_.f);Q([Object(_.d)({required:!0,type:Object})],H.prototype,"product",void 0),Q([Object(_.d)(Number)],H.prototype,"count",void 0);var W=H=Q([Object(_.a)({apollo:{reviewsData:{fetchPolicy:"cache-and-network",query:P,update:function(data){var e,t,n,r=null!==(e=null===(t=data.reviewsData)||void 0===t?void 0:t.items)&&void 0!==e?e:[],o=null!==(n=this.reviewsData)&&void 0!==n?n:[];return r.length?o.some((function(e){return e.id===r[0].id}))?r:[].concat(Object(l.a)(o),Object(l.a)(r)):o},variables:function(){return{limit:15,offset:this.offset,productId:this.product.id}}}},components:{BasicButton:C.a,BasicImage:k.a,BasicTitle:I.default,DetailReviewsTabGallery:F,Divider:D.a,Loader:R.a,ProductRatings:O.a,Review:x.a,ReviewImage:j.a}})],H),X=(n(2289),Object(T.a)(W,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[!e.reviewsData.length&&e.$apollo.queries.reviewsData.loading?n("div",{staticClass:"panel-reviews__loader"},[n("loader",{attrs:{size:"medium"}})],1):e._e(),n("div",{staticClass:"panel-reviews",attrs:{"data-sel":"product-detail-reviews"}},[e.ratings?n("div",{staticClass:"panel-reviews__left-column"},[n("basic-title",{staticClass:"panel-reviews__title",attrs:{level:"2"}},[e._v("\n        "+e._s(e.translations.rating_header)+" ("+e._s(e.ranksCount)+")\n      ")]),n("product-ratings",{staticClass:"panel-reviews__stats",attrs:{translations:e.translations,ratings:e.ratings}})],1):e._e(),e.reviewsData.length?n("div",{staticClass:"panel-reviews__right-column"},[n("basic-title",{staticClass:"panel-reviews__title",attrs:{level:"2"}},[e._v("\n        "+e._s(e.translations.reviews)+" ("+e._s(e.reviewsTotalCount)+")\n      ")]),e._t("product-selector"),e._l(e.reviews,(function(t,r){return n("div",{key:t.user+r},[n("review",{attrs:{review:t,full:!0,translations:e.translations},on:{"click-like":function(n){return e.onClickLike(t,n)}}},e._l(t.medias,(function(image,r){return n("review-image",{key:image.id,attrs:{alt:"image.id","image-url":e.getImageUrl(image.id,{type:e.ImageSize.ICON_LARGE})},on:{"on-click":function(n){return e.onReviewImageClick({reviewId:t.id,imageIndex:r})}}})})),1),r!==e.reviews.length-1?n("divider",{staticClass:"panel-reviews__divider"}):e._e()],1)})),e.isLoadMoreReviewsBtnShown?n("basic-button",{staticClass:"panel-reviews__load-more",attrs:{type:"tertiary",loading:e.$apollo.queries.reviewsData.loading},on:{click:e.loadMoreReviews}},[e._v("\n        "+e._s(e.translations.load_next_reviews)+"\n      ")]):e._e()],2):e._e(),e.isReviewGalleryOpen?n("detail-reviews-tab-gallery",{attrs:{product:e.product,"reviews-data":e.reviewsData,"active-review-id":e.activeReviewId,"active-review-image-index":e.activeReviewImageIndex},on:{close:e.onReviewGalleryClose}}):e._e()],1)])}),[],!1,null,"117fc70e",null));t.a=X.exports},1655:function(e,t,n){var content=n(2290);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(19).default)("12237ec0",content,!0,{sourceMap:!1})},2289:function(e,t,n){"use strict";n(1655)},2290:function(e,t,n){var r=n(18)((function(i){return i[1]}));r.push([e.i,".panel-reviews[data-v-117fc70e]{display:flex;flex-wrap:wrap;padding:30px 0}@media(min-width:1025px){.panel-reviews[data-v-117fc70e]{flex-wrap:nowrap}}.panel-reviews__loader[data-v-117fc70e]{margin-top:30px}.panel-reviews__left-column[data-v-117fc70e]{flex:1 0 100%;margin-bottom:20px}@media(min-width:1025px){.panel-reviews__left-column[data-v-117fc70e]{flex:0;margin-bottom:0;min-width:430px}}@media(max-width:800px){.panel-reviews__title[data-v-117fc70e]{font-size:18px;line-height:24px}}.panel-reviews__divider[data-v-117fc70e]{border-bottom:1px solid #d8d8d8;margin:20px 0}.panel-reviews__stats[data-v-117fc70e]{padding:20px;background-color:#f5f5f5;border-radius:2px}@media(min-width:1025px){.panel-reviews__stats[data-v-117fc70e]{margin-right:30px}}.panel-reviews__right-column[data-v-117fc70e]{flex:1 1 auto}.panel-reviews__load-more[data-v-117fc70e]{margin:10px auto}",""]),e.exports=r}}]);
//# sourceMappingURL=24706e6.527.js.map